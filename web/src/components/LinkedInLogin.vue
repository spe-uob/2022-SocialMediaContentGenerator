<template>
  <div>
    <!--<h1>LinkedIn API Authorization</h1>-->
    <div v-if="!authorized">
      <!--<p>Click the button to authorize this app to access your LinkedIn profile:</p>-->
      <q-btn class="flex justify-center full-width" color="light-blue" icon="fa-brands fa-linkedin" label="sign in with LinkedIn" @click="authorize" rounded/>
    </div>
    <div v-else>
      <p>You are authorized to access the LinkedIn API.</p>
      <p>Your access token is: {{ access_token }}</p>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
import qs from 'qs'

const client_id = '78sme225fsy5by'
const client_secret = 'J3xg14qRTV87viVq'
const redirect_uri = 'http://localhost:9000/LinkedInPost'
const scope = 'r_liteprofile r_emailaddress'
export default {
  name: "linkedInLogin",
  data() {
    return {
      authorized: false,
      access_token: '',
    }
  },
  methods: {
    authorize() {
      const state = Math.random().toString(36).substring(7)
      const linkedinAuthUrl = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${client_id}&redirect_uri=${encodeURIComponent(redirect_uri)}&state=${state}&scope=${scope}`
      window.location.href = linkedinAuthUrl
      this.$router.push("/LinkedInPost")
    },
    retrieveAccessToken() {
      const code = new URLSearchParams(window.location.search).get('code')
      if (code) {
        const data = {
          grant_type: 'authorization_code',
          code,
          redirect_uri,
          client_id,
          client_secret,
        }

        const headers = {
          'Content-Type': 'application/x-www-form-urlencoded',
        }

        axios.post('https://www.linkedin.com/oauth/v2/accessToken', qs.stringify(data), { headers })
          .then(response => {
            this.authorized = true
            this.access_token = response.data.access_token
          })
          .catch(error => console.error(error))
      }
    },
  },
  mounted() {
    this.retrieveAccessToken()
  },
}
</script>

<style scoped>

</style>
